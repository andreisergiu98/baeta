"use strict";(self.webpackChunk_baeta_website=self.webpackChunk_baeta_website||[]).push([["6872"],{59681:function(e,n,t){t.r(n),t.d(n,{frontMatter:()=>l,default:()=>h,toc:()=>c,metadata:()=>a,assets:()=>u,contentTitle:()=>o});var a=JSON.parse('{"id":"extensions/authorization","title":"Authorization","description":"Baeta provides a flexible and type-safe authorization system that allows you to define granular access controls at both operation and field levels. With support for default scopes, dynamic rules, and a permission granting system, you can implement complex authorization patterns while maintaining clean and maintainable code.","source":"@site/docs/extensions/authorization.mdx","sourceDirName":"extensions","slug":"/extensions/authorization","permalink":"/docs/extensions/authorization","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"defaultSidebar","previous":{"title":"Extensions","permalink":"/docs/extensions/"},"next":{"title":"Complexity","permalink":"/docs/extensions/complexity"}}'),s=t(92669),r=t(51846),i=t(31867);let l={sidebar_position:10},o="Authorization",u={},c=[{value:"Key Features",id:"key-features",level:2},{value:"Installation",id:"installation",level:2},{value:"Basic Setup",id:"basic-setup",level:2},{value:"Authorization Examples",id:"authorization-examples",level:2},{value:"Basic Static Rules",id:"basic-static-rules",level:3},{value:"Post-Resolution Authorization",id:"post-resolution-authorization",level:3},{value:"Subscription Rules",id:"subscription-rules",level:3},{value:"Type-wide Rules",id:"type-wide-rules",level:3},{value:"Grants system",id:"grants-system",level:3},{value:"Authorization Operators",id:"authorization-operators",level:3},{value:"Default Scopes",id:"default-scopes",level:2},{value:"Defining Default Scopes",id:"defining-default-scopes",level:3},{value:"Skipping Default Scopes",id:"skipping-default-scopes",level:3}];function d(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authorization",children:"Authorization"})}),"\n",(0,s.jsx)(n.p,{children:"Baeta provides a flexible and type-safe authorization system that allows you to define granular access controls at both operation and field levels. With support for default scopes, dynamic rules, and a permission granting system, you can implement complex authorization patterns while maintaining clean and maintainable code."}),"\n",(0,s.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Type-safe authorization rules"}),"\n",(0,s.jsx)(n.li,{children:"Default scopes with override capability"}),"\n",(0,s.jsx)(n.li,{children:"Pre and post-resolution authorization"}),"\n",(0,s.jsx)(n.li,{children:"Granular field-level permissions"}),"\n",(0,s.jsx)(n.li,{children:"Permission grants between resolvers"}),"\n",(0,s.jsx)(n.li,{children:"Scope caching for performance"}),"\n",(0,s.jsx)(n.li,{children:"Async/sync authorization support"}),"\n",(0,s.jsx)(n.li,{children:"Subscription-specific controls"}),"\n",(0,s.jsx)(n.li,{children:"Type-wide authorization rules"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n","\n",(0,s.jsx)(i.p,{package:"@baeta/extension-auth"}),"\n",(0,s.jsx)(n.h2,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Define Authorization Scopes"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { UnauthenticatedError } from "@baeta/errors";\nimport { authExtension } from "@baeta/extension-auth";\nimport type { Context } from "../types/context";\n\ndeclare global {\n  export namespace AuthExtension {\n    export interface Scopes {\n      isPublic: boolean;\n      isLoggedIn: boolean;\n      hasAccess: "guest" | "user" | "moderator" | "admin";\n    }\n\n    export interface GrantsMap {\n      readUserPhotos: boolean;\n    }\n  }\n}\n\nexport const authExt = authExtension<Context>(async (ctx) => {\n  const accessList: string[] = ["guest", "user"];\n\n  // You can fetch data before the scopes are created\n\n  return {\n    isPublic: true,\n    isLoggedIn: async () => {\n      // But you can also use scope loaders, which will be resolved lazily, when needed\n      if (!ctx.userId) {\n        throw new UnauthenticatedError();\n      }\n      return true;\n    },\n    hasAccess: (access: string) => {\n      // Scope loaders are also required for non-boolean scopes\n      return ctx.user?.accessList.includes(access) ?? false;\n    },\n  };\n});\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Register the Extension"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { createExtensions } from "@baeta/core";\nimport { authExt } from "./auth-extension";\n\nexport default createExtensions(\n  authExt,\n  //... other extensions\n);\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Authorization checks should be registered first in your chain, as they determine if a request can proceed at all. This ensures unauthorized requests are rejected early in the process.\nThe only exception being the ",(0,s.jsx)(n.code,{children:"complexity"})," extension."]})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Point Baeta to extensions entrypoint (if you haven't already)"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'export default defineConfig({\n  graphql: {\n    extensions: "src/extensions/index.ts",\n    // ... other config\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h2,{id:"authorization-examples",children:"Authorization Examples"}),"\n",(0,s.jsx)(n.h3,{id:"basic-static-rules",children:"Basic Static Rules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Public or authenticated access\nQuery.user.$auth({\n  $or: {\n    isPublic: true,\n    isLoggedIn: true,\n  },\n});\n\n// Admin-only access\nMutation.createUser.$auth({\n  hasAccess: "admin",\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"post-resolution-authorization",children:"Post-Resolution Authorization"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Post-auth checks permission after resolver execution\n// Useful to avoid double database queries when you need the resource for permission checking\nQuery.user.$postAuth((params, result) => {\n  if (result && result.id === params.ctx.userId) {\n    return true; // Allow access if user is requesting their own data\n  }\n  return { hasAccess: "admin" }; // Require admin access for other users\' data\n});\n\n// Compared to pre-resolution auth which might require an extra database query\nQuery.user.$auth(async (params) => {\n  const user = await db.user.findFirst({\n    // Extra database query\n    where: { id: params.args.id },\n  });\n\n  if (user && user.id === params.ctx.userId) return {};\n  return { hasAccess: "admin" };\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"subscription-rules",children:"Subscription Rules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Apply to subscription phase\nSubscription.userCreated.subscribe.$auth({\n  isLoggedIn: true,\n});\n\n// Apply to resolve phase\nSubscription.userCreated.resolve.$auth({\n  isLoggedIn: true,\n});\n\n// Apply to both phases\nSubscription.userCreated.$auth({\n  isLoggedIn: true,\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"type-wide-rules",children:"Type-wide Rules"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Apply to all Query fields\nQuery.$auth({\n  isLoggedIn: true,\n});\n\n// Apply to all User fields\nUser.$auth({\n  isLoggedIn: true,\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"grants-system",children:"Grants system"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Grant permission\nQuery.user.$auth(\n  {\n    $or: { isPublic: true, isLoggedIn: true },\n  },\n  {\n    grants: ["readUserPhotos"],\n  },\n);\n\n// Use granted permission\nUser.photos.$auth({\n  $granted: "readUserPhotos",\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"authorization-operators",children:"Authorization Operators"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$or"}),": Any condition must be true"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$and"}),": All conditions must be true"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$chain"}),": Sequential evaluation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$race"}),": Parallel evaluation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"$granted"}),": Check granted permissions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"default-scopes",children:"Default Scopes"}),"\n",(0,s.jsx)(n.p,{children:"Default scopes provide base authorization rules that apply to all operations. They are defined when creating the auth extension and are combined with local rules using an AND operator."}),"\n",(0,s.jsx)(n.h3,{id:"defining-default-scopes",children:"Defining Default Scopes"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"export const authExt = authExtension<Context>(\n  async (ctx) => {\n    // Define user scope values as explained above\n    return {...};\n  },\n  {\n    // All queries, mutations, and subscriptions will require the user to be logged in.\n    // You will still need to pay attention for relationships and nested queries.\n    defaultScopes: {\n      Query: {\n        isLoggedIn: true,\n      },\n      Mutation: {\n        isLoggedIn: true,\n      },\n      Subscription: {\n        subscribe: {\n          isLoggedIn: true,\n        },\n      },\n    },\n  },\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"skipping-default-scopes",children:"Skipping Default Scopes"}),"\n",(0,s.jsxs)(n.p,{children:["You can bypass default scopes for specific operations using the ",(0,s.jsx)(n.code,{children:"skipDefaults"})," option:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"Query.publicContent.$auth(\n  {\n    isPublic: true,\n  },\n  {\n    skipDefaults: true,\n  },\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For detailed examples, see the ",(0,s.jsx)(n.a,{href:"https://github.com/andreisergiu98/baeta/tree/main/examples/auth",children:"Baeta authorization example"}),"."]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},31867:function(e,n,t){t.d(n,{b:()=>w,p:()=>v});var a=t(92669),s=t(1718),r=t(60650),i=t(66207);function l(e){let{children:n,hidden:t,className:s}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.Z)("tabItem_iagj",s),hidden:t,children:n})}var o=t(36447),u=t(63497),c=t(89691),d=t(38789),h=t(88770),p=t(93970);function x(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){let{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function f(e){let{value:n,tabValues:t}=e;return t.some(e=>e.value===n)}var m=t(81820);function g(e){let{className:n,block:t,selectedValue:s,selectValue:r,tabValues:l}=e,u=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.o5)(),d=e=>{let n=e.currentTarget,t=l[u.indexOf(n)].value;t!==s&&(c(n),r(t))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{let t=u.indexOf(e.currentTarget)+1;n=u[t]??u[0];break}case"ArrowLeft":{let t=u.indexOf(e.currentTarget)-1;n=u[t]??u[u.length-1]}}n?.focus()};return(0,a.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":t},n),children:l.map(e=>{let{value:n,label:t,attributes:r}=e;return(0,a.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{u.push(e)},onKeyDown:h,onClick:d,...r,className:(0,i.Z)("tabs__item","tabItem_rLPU",r?.className,{"tabs__item--active":s===n}),children:t??n},n)})})}function b(e){let{lazy:n,children:t,selectedValue:s}=e,l=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){let e=l.find(e=>e.props.value===s);return e?(0,r.cloneElement)(e,{className:(0,i.Z)("margin-top--md",e.props.className)}):null}return(0,a.jsx)("div",{className:"margin-top--md",children:l.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function j(e){let n=function(e){let{defaultValue:n,queryString:t=!1,groupId:a}=e,s=function(e){let{values:n,children:t}=e;return(0,r.useMemo)(()=>{let e=n??x(t).map(e=>{let{props:{value:n,label:t,attributes:a,default:s}}=e;return{value:n,label:t,attributes:a,default:s}}),a=(0,h.lx)(e,(e,n)=>e.value===n.value);if(a.length>0)throw Error(`Docusaurus error: Duplicate values "${a.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`);return e},[n,t])}(e),[i,l]=(0,r.useState)(()=>(function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!f({value:n,tabValues:t}))throw Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}let a=t.find(e=>e.default)??t[0];if(!a)throw Error("Unexpected error: 0 tabValues");return a.value})({defaultValue:n,tabValues:s})),[o,m]=function(e){let{queryString:n=!1,groupId:t}=e,a=(0,u.k6)(),s=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,d._X)(s),(0,r.useCallback)(e=>{if(!s)return;let n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})},[s,a])]}({queryString:t,groupId:a}),[g,b]=function(e){let{groupId:n}=e,t=n?`docusaurus.tab.${n}`:null,[a,s]=(0,p.Nk)(t);return[a,(0,r.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:a}),j=(()=>{let e=o??g;return f({value:e,tabValues:s})?e:null})();return(0,c.Z)(()=>{j&&l(j)},[j]),{selectedValue:i,selectValue:(0,r.useCallback)(e=>{if(!f({value:e,tabValues:s}))throw Error(`Can't select invalid tab value=${e}`);l(e),m(e),b(e)},[m,b,s]),tabValues:s}}(e);return(0,a.jsxs)("div",{className:(0,i.Z)("tabs-container","tabList_qd9z"),children:[(0,a.jsx)(g,{...n,...e}),(0,a.jsx)(b,{...n,...e})]})}function y(e){let n=(0,m.Z)();return(0,a.jsx)(j,{...e,children:x(e.children)},String(n))}function v(e){let n=e.dev?" -D":"";return(0,a.jsxs)(y,{groupId:"package-manager",children:[(0,a.jsx)(l,{value:"yarn",children:(0,a.jsxs)(s.Z,{language:"bash",children:["yarn add ",e.package,n]})}),(0,a.jsx)(l,{value:"npm",children:(0,a.jsxs)(s.Z,{language:"bash",children:["npm install ",e.package,n]})}),(0,a.jsx)(l,{value:"pnpm",children:(0,a.jsxs)(s.Z,{language:"bash",children:["pnpm add ",e.package,n]})}),(0,a.jsx)(l,{value:"bun",children:(0,a.jsxs)(s.Z,{language:"bash",children:["bun add ",e.package,n]})})]})}function w(e){return(0,a.jsxs)(y,{groupId:"package-manager",children:[(0,a.jsx)(l,{value:"yarn",children:(0,a.jsxs)(s.Z,{language:"bash",children:["yarn create ",e.package]})}),(0,a.jsx)(l,{value:"npm",children:(0,a.jsxs)(s.Z,{language:"bash",children:["npx create-",e.package]})}),(0,a.jsx)(l,{value:"pnpm",children:(0,a.jsxs)(s.Z,{language:"bash",children:["pnpm create ",e.package]})}),(0,a.jsx)(l,{value:"bun",children:(0,a.jsxs)(s.Z,{language:"bash",children:["bun create ",e.package]})}),(0,a.jsx)(l,{value:"yarn-2",label:"yarn 2+",children:(0,a.jsxs)(s.Z,{language:"bash",children:["yarn dlx create-",e.package]})})]})}},51846:function(e,n,t){t.d(n,{Z:()=>l,a:()=>i});var a=t(60650);let s={},r=a.createContext(s);function i(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);